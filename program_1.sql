CREATE TABLE PUBLISHER ( NAME VARCHAR(20) PRIMARY KEY, ADDRESS VARCHAR(50) NOT NULL, PHONE VARCHAR(20) );

CREATE TABLE BOOK (BOOK_ID INTEGER PRIMARY KEY, TITLE VARCHAR(20) NOT NULL, PUBLISHER_NAME VARCHAR(20) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE, PUB_YEAR VARCHAR(10));

CREATE TABLE BOOK_AUTHOR (BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, AUTHOR_NAME VARCHAR(20) NOT NULL, PRIMARY KEY(BOOK_ID));

CREATE TABLE LIBRARY_BRANCH (BRANCH_ID INTEGER PRIMARY KEY, BRANCH_NAME VARCHAR(20) NOT NULL, ADDRESS VARCHAR(50) );

CREATE TABLE BOOK_LENDING (BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, BRANCH_ID INTEGER REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE, CARD_NO INTEGER NOT NULL, DATE_OUT DATE NOT NULL, DUE_DATE DATE, PRIMARY KEY(BOOK_ID,BRANCH_ID));

CREATE TABLE BOOK_COPIES (BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, BRANCH_ID INTEGER REFERENCES LIBRARY_BRANCH(BRANCH_ID), NO_OF_COPIES INTEGER, PRIMARY KEY(BOOK_ID,BRANCH_ID) );

INSERT INTO PUBLISHER VALUES('PEARSON', 'NEW DELHI', 9996621456); 
INSERT INTO PUBLISHER VALUES('OXFORD', 'MUMBAI', 9966884422); 
INSERT INTO PUBLISHER VALUES('MC GRAW HILL', 'CHENNAI', 8866333444); 
INSERT INTO PUBLISHER VALUES('O_REILLY', 'MANGLORE', 9898989898); 
INSERT INTO PUBLISHER VALUES('APRESS & DREAMTECH', 'MAHARASTRA', 9876549876);


INSERT INTO BOOK VALUES(2001, 'DBMS', 'PEARSON', '2015');
INSERT INTO BOOK VALUES(2002, 'COMPUTER NETWORKS', 'OXFORD', '2019');
INSERT INTO BOOK VALUES(2003, 'JAVA', 'MC GRAW HILL', '2016');
INSERT INTO BOOK VALUES(2004, 'C PROGRAMMING', 'O_REILLY', '2014');
INSERT INTO BOOK VALUES(2005, 'PHP', 'APRESS & DREAMTECH', '2017');


INSERT INTO BOOK_AUTHOR VALUES(2001,'KANISHKA BEDI'); 
INSERT INTO BOOK_AUTHOR VALUES(2002,'POORNIMA M'); 
INSERT INTO BOOK_AUTHOR VALUES(2003,'P C TRIPATHI'); 
INSERT INTO BOOK_AUTHOR VALUES(2004,'P N REDDY'); 
INSERT INTO BOOK_AUTHOR VALUES(2005,'VISHWA KIRAN');


INSERT INTO LIBRARY_BRANCH VALUES(3001, 'R T NAGAR', 'BANGALORE'); 
INSERT INTO LIBRARY_BRANCH VALUES(3002, 'MALESHWARAM', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH VALUES(3003, 'SECTOR 21', 'NOIDA'); 
INSERT INTO LIBRARY_BRANCH VALUES(3004, 'KLS INSTITUTE', 'BELGAUM'); 
INSERT INTO LIBRARY_BRANCH VALUES(3005, 'YELAHANKA', 'BANGALORE');


INSERT INTO BOOK_LENDING VALUES (2001, 3001, 4001, '2017-01-02', '2017-02-02');
INSERT INTO BOOK_LENDING VALUES (2002, 3001, 4001, '2017-01-07', '2017-02-07');
INSERT INTO BOOK_LENDING VALUES (2003, 3001, 4001, '2017-01-10', '2017-02-10');
INSERT INTO BOOK_LENDING VALUES (2004, 3001, 4001, '2017-01-20', '2017-02-20');
INSERT INTO BOOK_LENDING VALUES (2005, 3002, 4005, '2017-01-20', '2017-02-20');


INSERT INTO BOOK_COPIES VALUES(2001, 3001, 10);
INSERT INTO BOOK_COPIES VALUES(2002, 3001, 10);
INSERT INTO BOOK_COPIES VALUES(2003, 3001, 10);
INSERT INTO BOOK_COPIES VALUES(2003, 3002, 10);
INSERT INTO BOOK_COPIES VALUES(2002, 3002, 10);
INSERT INTO BOOK_COPIES VALUES(2001, 3005, 10);


SELECT * FROM PUBLISHER;
SELECT * FROM BOOK;
SELECT * FROM BOOK_AUTHOR;
SELECT * FROM LIBRARY_BRANCH;
SELECT * FROM BOOK_LENDING;
SELECT * FROM BOOK_COPIES;


--QUERIES
--1--------------------------------------------------------------------------------------

SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME, C.NO_OF_COPIES, C.BRANCH_ID
FROM BOOK B, BOOK_AUTHOR A, BOOK_COPIES C
WHERE B.BOOK_ID=A.BOOK_ID AND B.BOOK_ID=C.BOOK_ID;

--2--------------------------------------------------------------------------------------

SELECT L.CARD_NO
FROM BOOK_LENDING L
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-06-30'
GROUP BY L.CARD_NO
HAVING COUNT(CARD_NO) > 3;

--3--------------------------------------------------------------------------------------

SELECT * FROM BOOK;

DELETE FROM BOOK WHERE BOOK_ID=2004;

SELECT * FROM BOOK;

--4--------------------------------------------------------------------------------------

CREATE VIEW VW_PUB_YEAR AS
SELECT PUB_YEAR FROM BOOK;

SELECT * FROM VW_PUB_YEAR;

--5--------------------------------------------------------------------------------------

CREATE VIEW VW_BK_COPIES AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM BOOK B, BOOK_COPIES C
WHERE B.BOOK_ID=C.BOOK_ID;

SELECT * FROM VW_BK_COPIES;

-----------------------------------------------------------------------------------------